<!DOCTYPE html>
<html lang="ja" style="-webkit-print-color-adjust:exact;print-color-adjust:exact;color-adjust:exact;">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IMOK æ©Ÿæè¦‹ç©ã‚Š</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@400;500&family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #111;
    --surface: #1a1a1a;
    --surface2: #222;
    --border: #2e2e2e;
    --text: #e8e8e8;
    --muted: #666;
    --accent: #e8d44d;
    --accent2: #aaa;
    --checked-bg: #1e1d0e;
    --checked-border: #5a5010;
  }
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  body { background:var(--bg); color:var(--text); font-family:'Noto Sans JP',sans-serif; font-weight:300; font-size:15px; }
  .header { border-bottom:1px solid var(--border); padding:16px 20px; display:flex; align-items:center; gap:14px; position:sticky; top:0; background:var(--bg); z-index:100; }
  .header-logo { font-family:'Bebas Neue',sans-serif; font-size:26px; letter-spacing:4px; color:var(--accent); }
  .header-sub { font-size:10px; letter-spacing:2px; color:var(--muted); }
  .main { padding:20px 16px 200px; }
  .section-hd { font-family:'IBM Plex Mono',monospace; font-size:10px; letter-spacing:3px; color:var(--muted); text-transform:uppercase; margin-bottom:16px; padding-bottom:10px; border-bottom:1px solid var(--border); }
  .select-bar { display:flex; gap:8px; margin-bottom:20px; }
  .btn-sm { font-family:'IBM Plex Mono',monospace; font-size:11px; letter-spacing:1px; padding:10px 18px; border:1px solid var(--border); background:var(--surface); color:var(--muted); cursor:pointer; border-radius:8px; text-transform:uppercase; }
  .btn-sm:active { background:var(--surface2); color:var(--accent); }
  .category { margin-bottom:28px; }
  .category-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
  .category-name { font-family:'IBM Plex Mono',monospace; font-size:10px; letter-spacing:3px; color:var(--accent2); text-transform:uppercase; padding-left:4px; }
  .cat-btns { display:flex; gap:6px; }
  .btn-cat { font-family:'IBM Plex Mono',monospace; font-size:10px; padding:5px 10px; border:1px solid var(--border); background:transparent; color:var(--muted); cursor:pointer; border-radius:6px; letter-spacing:1px; text-transform:uppercase; }
  .btn-cat:active { color:var(--accent); border-color:var(--accent); }
  .gear-item { display:flex; align-items:center; gap:14px; padding:13px 14px; border-radius:10px; border:1.5px solid transparent; margin-bottom:5px; cursor:pointer; user-select:none; background:var(--surface); }
  .gear-item:active { opacity:0.75; }
  .gear-item.selected { background:var(--checked-bg); border-color:var(--checked-border); }
  .gear-item input[type="checkbox"] { display:none; }
  .chk { width:28px; height:28px; border-radius:7px; border:2px solid #3a3a3a; background:var(--surface2); flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:18px; line-height:1; color:transparent; transition:all 0.15s; }
  .gear-item.selected .chk { background:var(--accent); border-color:var(--accent); color:#111; }
  .gear-name { font-size:14px; line-height:1.45; flex:1; }
  .gear-item.selected .gear-name { color:var(--accent); font-weight:500; }

  /* BOTTOM BAR */
  .bottom-bar { position:fixed; bottom:0; left:0; right:0; background:var(--surface); border-top:1px solid var(--border); z-index:200; overflow:hidden; }
  .bottom-bar-handle { padding:14px 20px; display:flex; align-items:center; justify-content:space-between; cursor:pointer; }
  .bar-left { display:flex; align-items:baseline; gap:10px; }
  .bar-count { font-family:'Bebas Neue',sans-serif; font-size:34px; color:var(--accent); line-height:1; }
  .bar-count-label { font-size:12px; color:var(--muted); letter-spacing:1px; }
  .bar-right { display:flex; align-items:center; gap:14px; }
  .bar-price { font-family:'Bebas Neue',sans-serif; font-size:22px; color:var(--text); letter-spacing:1px; }
  .bar-toggle { width:36px; height:36px; border-radius:50%; background:var(--surface2); border:1px solid var(--border); display:flex; align-items:center; justify-content:center; font-size:16px; transition:transform 0.3s; }
  .bottom-bar.expanded .bar-toggle { transform:rotate(180deg); }
  .sheet-body { max-height:0; overflow:hidden; transition:max-height 0.35s cubic-bezier(0.4,0,0.2,1); }
  .bottom-bar.expanded .sheet-body { max-height:80vh; overflow-y:auto; }
  .sheet-inner { padding:0 20px 32px; display:flex; flex-direction:column; gap:16px; }

  .price-block, .client-block { background:var(--surface2); border:1px solid var(--border); border-radius:10px; padding:16px; }
  .block-label { font-family:'IBM Plex Mono',monospace; font-size:10px; letter-spacing:3px; color:var(--muted); text-transform:uppercase; margin-bottom:10px; }
  .price-presets { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
  .preset-btn { font-family:'IBM Plex Mono',monospace; font-size:12px; padding:8px 14px; border:1.5px solid var(--border); background:var(--surface); color:var(--text); cursor:pointer; border-radius:6px; }
  .preset-btn.active { background:var(--accent); color:#000; border-color:var(--accent); font-weight:500; }
  .price-input-wrap { display:flex; align-items:center; gap:8px; background:var(--bg); border:1.5px solid var(--border); border-radius:8px; padding:10px 16px; }
  .price-input-wrap:focus-within { border-color:var(--accent); }
  .price-currency { font-family:'Bebas Neue',sans-serif; font-size:22px; color:var(--muted); }
  .price-input { background:transparent; border:none; outline:none; color:var(--accent); font-family:'Bebas Neue',sans-serif; font-size:30px; width:100%; }
  .field-group { margin-bottom:12px; }
  .field-label { font-family:'IBM Plex Mono',monospace; font-size:10px; letter-spacing:2px; color:var(--muted); text-transform:uppercase; margin-bottom:6px; }
  .field-input { width:100%; background:var(--bg); border:1.5px solid var(--border); border-radius:8px; padding:12px 14px; color:var(--text); font-family:'Noto Sans JP',sans-serif; font-size:15px; outline:none; }
  .field-input:focus { border-color:var(--accent); }
  .btn-generate { width:100%; background:var(--accent); color:#000; border:none; padding:18px; font-family:'Bebas Neue',sans-serif; font-size:20px; letter-spacing:4px; cursor:pointer; border-radius:10px; }
  .btn-generate:active { opacity:0.85; }
  .btn-generate:disabled { background:var(--border); color:var(--muted); }

  /* MODAL â€” A4ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º */
  .modal-overlay { position:fixed; inset:0; background:#707070; z-index:300; display:none; flex-direction:column; overflow-y:auto; }
  .modal-overlay.open { display:flex; }
  .modal { background:transparent; color:#111; width:100%; font-family:'Noto Sans JP',sans-serif; }
  .modal-actions { position:sticky; bottom:0; background:#3a3a3a; border-top:1px solid #555; padding:12px 20px; display:flex; gap:12px; z-index:10; }
  .btn-print { flex:1; background:var(--accent); color:#000; border:none; padding:14px; font-family:'Noto Sans JP',sans-serif; font-size:14px; font-weight:700; cursor:pointer; border-radius:8px; letter-spacing:1px; }
  .btn-close2 { background:transparent; color:#ccc; border:1px solid #555; padding:14px 20px; font-family:'Noto Sans JP',sans-serif; font-size:14px; cursor:pointer; border-radius:8px; }

  /* PDFä¿å­˜æ¡ˆå†…ãƒˆãƒ¼ã‚¹ãƒˆ */
  .pdf-toast { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#111; color:#fff; padding:28px 36px; border-radius:12px; z-index:500; text-align:center; box-shadow:0 8px 40px rgba(0,0,0,0.5); max-width:340px; width:90%; }
  .pdf-toast.show { display:block; }
  .pdf-toast-title { font-size:16px; font-weight:700; margin-bottom:12px; color:var(--accent); }
  .pdf-toast-body { font-size:13px; line-height:1.8; color:#ccc; margin-bottom:20px; }
  .pdf-toast-step { background:#222; border-radius:8px; padding:12px 16px; margin-bottom:10px; font-size:12px; text-align:left; }
  .pdf-toast-step strong { color:#fff; }
  .pdf-toast-btn { background:var(--accent); color:#000; border:none; padding:12px 32px; font-size:14px; font-weight:700; cursor:pointer; border-radius:8px; width:100%; }

  /* ===== 2-PAGE DOC STYLES ===== */
  .doc-pages { padding: 24px 12px 24px; display:flex; flex-direction:column; gap:16px; align-items:center; }

  /* A4æ¯”ç‡å›ºå®šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
  .page {
    background: #fff;
    font-family: 'Noto Sans JP', sans-serif;
    color: #111;
    /* A4: 210mm x 297mm â†’ å¹…ã«å¯¾ã—ã¦é«˜ã•141.4% */
    width: min(92vw, 560px);
    height: calc(min(92vw, 560px) * 1.414);
    padding: 0;
    margin: 0 auto;
    box-shadow: 0 4px 32px rgba(0,0,0,0.35);
    border-radius: 1px;
    overflow: hidden;
    position: relative;
    flex-shrink: 0;
  }
  /* å†…éƒ¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’scaleã§åˆã‚ã›ã‚‹ */
  .page-inner {
    position: absolute;
    top: 0; left: 0;
    width: 794px; /* 210mm @ 96dpi */
    height: 1123px; /* 297mm @ 96dpi */
    transform-origin: top left;
    padding: 72px 68px 60px;
    box-sizing: border-box;
  }
  .page1 .page-inner { display:flex; flex-direction:column; justify-content:space-between; }

  /* Header */
  .p1-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:16px; }
  .p1-logo { font-family:'Bebas Neue',sans-serif; font-size:32px; letter-spacing:4px; color:#111; line-height:1; }
  .p1-logo-sub { font-size:11px; color:#888; margin-top:4px; letter-spacing:1px; }
  .p1-right { text-align:right; }
  .p1-title { font-family:'Noto Sans JP',sans-serif; font-size:26px; font-weight:700; letter-spacing:6px; color:#111; line-height:1; }
  .p1-meta { font-size:12px; color:#888; margin-top:5px; letter-spacing:1px; font-family:'IBM Plex Mono',monospace; }

  .p1-rule { border:none; border-top:2px solid #111; margin:0 0 24px 0; }

  /* Info grid */
  .p1-info-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px 44px; margin-bottom:28px; }
  .p1-info-label { font-size:10px; color:#aaa; letter-spacing:1px; margin-bottom:5px; }
  .p1-info-value { font-size:15px; color:#111; border-bottom:1.5px solid #111; padding-bottom:5px; min-height:24px; }
  .p1-info-sub { font-size:10px; color:#666; margin-top:3px; line-height:1.7; }

  /* Main table */
  .p1-table { width:100%; border-collapse:collapse; margin-bottom:28px; }
  .p1-table thead tr { background:#111; color:#fff; }
  .p1-th-item { padding:10px 14px; font-size:12px; font-weight:700; text-align:left; width:25%; }
  .p1-th-detail { padding:10px 14px; font-size:12px; font-weight:700; text-align:left; }
  .p1-th-price { padding:10px 14px; font-size:12px; font-weight:700; text-align:right; width:15%; }
  .p1-td-item { padding:16px 14px; font-size:14px; font-weight:700; border-bottom:1px solid #e8e8e8; vertical-align:top; }
  .p1-td-detail { padding:16px 14px; font-size:12px; color:#555; border-bottom:1px solid #e8e8e8; vertical-align:top; line-height:1.8; }
  .p1-td-price { padding:16px 14px; font-size:14px; font-weight:500; text-align:right; border-bottom:1px solid #e8e8e8; vertical-align:top; letter-spacing:1px; }

  /* Total box */
  .p1-total-wrap { display:flex; justify-content:flex-end; }
  .p1-total-box { border:1.5px solid #111; border-radius:4px; padding:18px 24px; width:280px; }
  .p1-total-row { display:flex; justify-content:space-between; font-size:12px; color:#555; margin-bottom:9px; }
  .p1-total-rule { border:none; border-top:1px solid #ccc; margin:10px 0; }
  .p1-total-main { font-size:16px; font-weight:700; color:#111; margin-bottom:0; }
  .p1-total-main span:last-child { font-size:19px; }

  /* Page 2 */
  .p2-info-row { display:flex; gap:32px; margin-bottom:12px; font-size:13px; color:#666; }
  .p2-info-row strong { color:#111; }

  /* 3-column layout */
  .p2-columns {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 0 10px;
    align-items: start;
  }
  .p2-col { display:flex; flex-direction:column; gap:6px; min-width:0; }

  /* Column header (above each col) â€” rendered inside each col as first element via JS */
  .p2-col-header-bar {
    background: #111;
    color: #fff;
    padding: 6px 8px;
    font-size: 10px;
    font-weight: 400;
    letter-spacing: 2px;
    display: flex;
    gap: 6px;
    align-items: center;
    margin-bottom: 4px;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  .p2-col-num-h { width:22px; text-align:center; flex-shrink:0; }

  /* Each category block */
  .p2-cat-block { break-inside: avoid; min-width: 0; }
  .p2-cat-label {
    background: #f4f4f4;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1.5px;
    color: #888;
    text-transform: uppercase;
    padding: 5px 8px;
    font-family: 'IBM Plex Mono', monospace;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  .p2-row { display:flex; border-bottom:1px solid #f0f0f0; align-items:center; min-width:0; }
  .p2-num { width:22px; padding:5px 0 5px 4px; font-size:10px; color:#bbb; font-family:monospace; text-align:center; flex-shrink:0; }
  .p2-item { padding:5px 5px; font-size:12px; flex:1; line-height:1.35; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-width:0; }

  .p2-footer { margin-top:12px; border-top:1px solid #ddd; padding-top:10px; font-size:11px; color:#aaa; text-align:center; }

  @page {
    size: A4;
    margin: 0;
  }
  /* Safariç”¨ï¼šãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼éè¡¨ç¤ºã®ãŸã‚ã®marginåˆ¶å¾¡ */
  @page :first { margin: 0; }
  @page { margin: 0; }

  @media print {
    html, body {
      background: #fff !important;
      margin: 0 !important;
      padding: 0 !important;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
      color-adjust: exact !important;
    }
    body > .header,
    body > .main,
    body > .bottom-bar {
      display: none !important;
    }
    .modal-overlay {
      display: block !important;
      position: static !important;
      background: #fff !important;
      overflow: visible !important;
      z-index: auto !important;
      width: 100% !important;
    }
    .modal {
      background: #fff !important;
      width: 100% !important;
    }
    .modal-actions { display: none !important; }

    .doc-pages {
      padding: 0 !important;
      gap: 0 !important;
      display: block !important;
    }

    /* Page 1 â€” é«˜ã•ã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«ä»»ã›ã‚‹ */
    .page1 {
      width: 210mm !important;
      max-width: 210mm !important;
      aspect-ratio: unset !important;
      padding: 0 !important;
      box-sizing: border-box !important;
      background: #fff !important;
      margin: 0 !important;
      box-shadow: none !important;
      border-radius: 0 !important;
      overflow: visible !important;
      display: block !important;
      position: relative !important;
      page-break-after: always !important;
      break-after: page !important;
    }

    /* Page 2 */
    .page2 {
      width: 210mm !important;
      max-width: 210mm !important;
      aspect-ratio: unset !important;
      padding: 0 !important;
      box-sizing: border-box !important;
      page-break-before: always !important;
      break-before: page !important;
      page-break-after: avoid !important;
      break-after: avoid !important;
      background: #fff !important;
      margin: 0 !important;
      box-shadow: none !important;
      border-radius: 0 !important;
      overflow: visible !important;
      display: block !important;
      position: relative !important;
    }

    /* page-inner: reset scale, auto height */
    .page-inner {
      transform: none !important;
      width: 210mm !important;
      height: auto !important;
      position: relative !important;
      top: auto !important; left: auto !important;
      padding: 18mm 18mm 14mm !important;
      box-sizing: border-box !important;
    }
    .page2 .page-inner {
      padding: 10mm 14mm 10mm !important;
    }

    /* URLãƒ»æ—¥æ™‚ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ï¼‰ã‚’éè¡¨ç¤º */
    @page { margin: 0; size: A4; }
    html { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    body::before, body::after { display: none !important; }
    .page1::after, .page2::after { display: none !important; }

    .p1-table thead tr {
      background: #111 !important;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
    .p1-table thead tr th {
      background: #111 !important;
      color: #fff !important;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
    .p2-col-header-bar {
      background: #111 !important;
      color: #fff !important;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
    .p2-cat-label {
      background: #f4f4f4 !important;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
      white-space: nowrap !important;
      overflow: visible !important;
      text-overflow: unset !important;
    }
    /* å°åˆ·æ™‚ï¼šæ©Ÿæåã‚’çœç•¥ãªã—ã§è¡¨ç¤º */
    .p2-item {
      white-space: nowrap !important;
      overflow: visible !important;
      text-overflow: unset !important;
      font-size: 9px !important;
      padding: 3px 3px !important;
    }
    .p2-num { font-size: 9px !important; width: 16px !important; }
    .p2-col { min-width: 0 !important; overflow: visible !important; }
    .p2-row { overflow: visible !important; }
    .p2-columns { gap: 0 6px !important; }
    .p2-col-header-bar { font-size: 9px !important; padding: 4px 6px !important; }
    .p2-cat-label { font-size: 8px !important; padding: 3px 4px !important; }
    .p1-info-label {
      color: #aaa !important;
      display: block !important;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
    .pdf-toast { display: none !important; }
  }

  @media (min-width:768px) {
    body { font-size:17px; }
    .header { padding:20px 40px; }
    .header-logo { font-size:32px; }
    .header-sub { font-size:13px; }
    .main { max-width:780px; margin:0 auto; padding:40px 40px 220px; }
    .section-hd { font-size:13px; margin-bottom:20px; padding-bottom:14px; }
    .select-bar { margin-bottom:24px; }
    .btn-sm { font-size:13px; padding:12px 22px; border-radius:10px; }
    .category { margin-bottom:36px; }
    .category-name { font-size:13px; letter-spacing:2px; }
    .btn-cat { font-size:12px; padding:7px 14px; }
    .gear-item { padding:16px 18px; border-radius:12px; margin-bottom:7px; }
    .chk { width:32px; height:32px; font-size:20px; border-radius:8px; }
    .gear-name { font-size:16px; }
    .bottom-bar { max-width:780px; left:50%; transform:translateX(-50%); border-radius:16px 16px 0 0; border-left:1px solid var(--border); border-right:1px solid var(--border); }
    .bottom-bar.expanded { transform:translateX(-50%); bottom:0; }
    .bar-count { font-size:44px; }
    .bar-count-label { font-size:15px; }
    .bar-price { font-size:28px; }
    .bar-toggle { width:44px; height:44px; font-size:18px; }
    .sheet-inner { padding:0 28px 48px; gap:20px; }
    .block-label { font-size:12px; }
    .preset-btn { font-size:14px; padding:10px 18px; }
    .price-input { font-size:36px; }
    .price-currency { font-size:28px; }
    .field-label { font-size:12px; }
    .field-input { font-size:17px; padding:14px 16px; }
    .btn-generate { font-size:22px; padding:20px; }
    .doc-pages { padding: 40px 40px 40px; gap: 24px; max-width: 800px; margin: 0 auto; }
    .page { width: min(86vw, 680px); height: calc(min(86vw, 680px) * 1.414); }
  }
</style>
</head>
<body>
<div class="header">
  <div class="header-logo">IMOK</div>
  <div class="header-sub">Personal Gear æ©Ÿæè¦‹ç©ã‚Š</div>
</div>

<div class="main">
  <div class="section-hd">æ©Ÿæã‚’é¸æŠ</div>
  <div class="select-bar">
    <button class="btn-sm" onclick="selectAll()">å…¨é¸æŠ</button>
    <button class="btn-sm" onclick="clearAll()">å…¨è§£é™¤</button>
  </div>
  <div id="gear-categories"></div>
</div>

<div class="bottom-bar" id="bottom-bar">
  <div class="bottom-bar-handle" onclick="toggleSheet()">
    <div class="bar-left">
      <span class="bar-count" id="bar-count">0</span>
      <span class="bar-count-label">ç‚¹é¸æŠä¸­</span>
    </div>
    <div class="bar-right">
      <span class="bar-price" id="bar-price">Â¥50,000</span>
      <div class="bar-toggle">â–²</div>
    </div>
  </div>
  <div class="sheet-body">
    <div class="sheet-inner">
      <div class="price-block">
        <div class="block-label">ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é‡‘é¡</div>
        <div class="price-presets">
          <button class="preset-btn" onclick="setPrice(30000,this)">Â¥30,000</button>
          <button class="preset-btn active" onclick="setPrice(50000,this)">Â¥50,000</button>
          <button class="preset-btn" onclick="setPrice(80000,this)">Â¥80,000</button>
          <button class="preset-btn" onclick="setPrice(100000,this)">Â¥100,000</button>
        </div>
        <div class="price-input-wrap">
          <span class="price-currency">Â¥</span>
          <input class="price-input" type="number" id="price-input" value="50000" step="5000" inputmode="numeric">
        </div>
      </div>
      <div class="client-block">
        <div class="field-group">
          <div class="field-label">å®›å…ˆï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåï¼‰</div>
          <input class="field-input" id="client-name" placeholder="æ ªå¼ä¼šç¤¾ã€‡ã€‡" type="text">
        </div>
        <div class="field-group">
          <div class="field-label">æ¡ˆä»¶å</div>
          <input class="field-input" id="project-name" placeholder="ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³æ’®å½±" type="text">
        </div>
        <div class="field-group">
          <div class="field-label">æ’®å½±æ—¥</div>
          <input class="field-input" id="shoot-date" type="date">
        </div>
        <div class="field-group" style="margin-bottom:0">
          <div class="field-label">è¦‹ç©ç•ªå·ï¼ˆä»»æ„ï¼‰</div>
          <input class="field-input" id="estimate-no" placeholder="EST-2024-001" type="text">
        </div>
      </div>
      <button class="btn-generate" id="gen-btn" onclick="generateEstimate()" disabled>è¦‹ç©æ›¸ã‚’ç”Ÿæˆã™ã‚‹</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal">
  <div class="modal">
    <div class="doc-pages" id="doc-content"></div>
    <div class="modal-actions">
      <button class="btn-print" onclick="printDoc()">ğŸ“„ PDFã¨ã—ã¦ä¿å­˜</button>
      <button class="btn-close2" onclick="closeModal()">é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>

<script>
const GEAR_DATA = [
  { cat:"ã‚·ãƒãƒ¬ãƒ³ã‚º / ã‚¢ãƒŠãƒ¢ãƒ«ãƒ•ã‚£ãƒƒã‚¯", items:["SIRUI Venus 1.6X Anamorphic 35mm","SIRUI Venus 1.6X Anamorphic 50mm","SIRUI Venus 1.6X Anamorphic 75mm","SIRUI Venus 1.6X Anamorphic 100mm","SIRUI Venus 1.6X Anamorphic 150mm","Zunow WHV-075 0.75å€ãƒ¯ã‚¤ã‚³ãƒ³"]},
  { cat:"ãƒãƒƒãƒˆãƒœãƒƒã‚¯ã‚¹ / ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ (4Ã—5.65)", items:["LMB-15 ãƒãƒƒãƒˆãƒœãƒƒã‚¯ã‚¹ (3stage)","ND0.3 (4Ã—5.65)","BlackPromist (4Ã—5.65)"]},
  { cat:"ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ / ãƒ¢ãƒ‹ã‚¿ãƒ¼", items:["Tilta Nucleus M ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ãƒ•ã‚©ãƒ¼ã‚«ã‚¹","TV-logic F-5A ãƒ¢ãƒ‹ã‚¿ãƒ¼","SmallHD 502 ãƒ¢ãƒ‹ã‚¿ãƒ¼","SmallHD indie 7 ãƒ¢ãƒ‹ã‚¿ãƒ¼"]},
  { cat:"ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ä¼é€", items:["Teradek BOLT 500 TX","Teradek BOLT 500 RX Ã—2","Accsoon CINEVIEW TX","transmitterç”¨ãƒ—ãƒ¬ãƒ¼ãƒˆã‚»ãƒƒãƒˆ","ã‚¹ãƒ”ã‚´ãƒƒãƒˆã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚»ãƒƒãƒˆ","iPad Ã—2"]},
  { cat:"ã‚¸ãƒ³ãƒãƒ« / ãƒªã‚°", items:["DJI RS4 ã‚¸ãƒ³ãƒãƒ«","RSç”¨ãƒãƒ³ãƒ‰ãƒ«","FX3 ãƒˆãƒƒãƒ—ãƒ—ãƒ¬ãƒ¼ãƒˆ","FX3 ãƒãƒ¼ãƒ•ã‚²ãƒ¼ã‚¸","Lå‹ãƒ—ãƒ¬ãƒ¼ãƒˆ","ãƒŸãƒ‹ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒªãƒ¼ã‚¹ã‚»ãƒƒãƒˆ"]},
  { cat:"ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ / ã‚±ãƒ¼ãƒ–ãƒ«", items:["NOGA ã‚¢ãƒ¼ãƒ ","BNCçŸ­ã‚±ãƒ¼ãƒ–ãƒ«","HDMIçŸ­ã‚±ãƒ¼ãƒ–ãƒ«","Dtapå»¶é•·/åˆ†é…","ãƒ¬ãƒ™ãƒ©ãƒ¼ã‚»ãƒƒãƒˆ","å…­è§’/ãƒã‚¸å¤‰æ›ã‚»ãƒƒãƒˆ","ãƒãƒ³ãƒ•ãƒ­ãƒƒãƒˆãƒ—ãƒ¬ãƒ¼ãƒˆã‚»ãƒƒãƒˆ","SmallRig ãƒŸãƒ‹ã‚·ã‚§ãƒ¼ãƒ‰","ãƒŠãƒã‚¯ãƒ©ãƒ³ãƒ—ã‚»ãƒƒãƒˆ","SHAPEãƒ‘ãƒ³æ£’","SmallRig 15mmãƒãƒ³ãƒ‰ãƒ«"]},
  { cat:"ä¸¸å½¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼", items:["82mm NDãƒ•ã‚£ãƒ«ã‚¿ãƒ¼","82mm PLãƒ•ã‚£ãƒ«ã‚¿ãƒ¼","82mm BDãƒ•ã‚£ãƒ«ã‚¿ãƒ¼","82mm GGãƒ•ã‚£ãƒ«ã‚¿ãƒ¼","77mm NDãƒ•ã‚£ãƒ«ã‚¿ãƒ¼","77mm BSãƒ•ã‚£ãƒ«ã‚¿ãƒ¼","77mm BDãƒ•ã‚£ãƒ«ã‚¿ãƒ¼","77mm LCãƒ•ã‚£ãƒ«ã‚¿ãƒ¼","77mm ENHANãƒ•ã‚£ãƒ«ã‚¿ãƒ¼","82mmãƒãƒªã‚¢ãƒ–ãƒ«NDãƒ•ã‚£ãƒ«ã‚¿ãƒ¼","77mmãƒãƒªã‚¢ãƒ–ãƒ«NDãƒ•ã‚£ãƒ«ã‚¿ãƒ¼","82mmãƒ—ãƒ­ã‚¯ã‚µãƒ¼"]},
  { cat:"ä¸‰è„š / é›²å°", items:["SmallRig TRIBEX ä¸‰è„š","SWFOTO LB-68 ãƒ¬ãƒ™ãƒªãƒ³ã‚°ãƒ™ãƒ¼ã‚¹","TRIBEXç”¨ã‚¹ãƒ—ãƒ¬ãƒƒã‚¿ãƒ¼"]},
  { cat:"ã‚«ãƒ¡ãƒ©æœ¬ä½“ / ãƒ¬ãƒ³ã‚º", items:["SONY FE 24-105mm F4","SONY Î±7s III","Î±7s IIIç”¨ã‚±ãƒ¼ã‚¸","NP-FZ100 ãƒãƒƒãƒ†ãƒªãƒ¼ Ã—3"]},
  { cat:"é›»æº / ãƒãƒƒãƒ†ãƒªãƒ¼", items:["ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒ†ãƒªãƒ¼","NP-F550 Ã—8","ãƒãƒ£ãƒ¼ã‚¸ãƒ£ãƒ¼ã‚»ãƒƒãƒˆ"]},
  { cat:"NIKONãƒ¬ãƒ³ã‚º (Fãƒã‚¦ãƒ³ãƒˆ)", items:["NIKON AI NIKKOR 20mm","NIKON AI NIKKOR 24mm","NIKON AI NIKKOR 35mm","NIKON AI NIKKOR 50mm","NIKON AI NIKKOR 85mm","NIKON AI NIKKOR 135mm","E-Fãƒã‚¦ãƒ³ãƒˆå¤‰æ›ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼"]},
  { cat:"DZOFilm Vespid (EFãƒã‚¦ãƒ³ãƒˆ)", items:["DZOFilm Vespid PRIME 25mm","DZOFilm Vespid PRIME 35mm","DZOFilm Vespid PRIME 50mm","DZOFilm Vespid PRIME 75mm","DZOFilm Vespid PRIME 100mm","DZOFilm Vespid PRIME 125mm","E-EFãƒã‚¦ãƒ³ãƒˆå¤‰æ›ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼","CANON EF 8-15mm T4 FishEye"]},
  { cat:"éŸ³å£° / ãã®ä»–", items:["ãƒ­ãƒ³ã‚°ã‚¢ãƒ¼ãƒ ","RODE ã‚¬ãƒ³ãƒã‚¤ã‚¯","3.5mmå»¶é•·ã‚±ãƒ¼ãƒ–ãƒ« / ã‚¤ãƒ¤ãƒ›ãƒ³","ã‚¹ãƒãƒ›ãƒ›ãƒ«ãƒ€ãƒ¼","ã‚¹ã‚¿ãƒ³ãƒ‰ç”¨é´ä¸‹","Ulanzi ãƒ•ã‚©ã‚°ãƒã‚·ãƒ³","ãƒ—ãƒªã‚ºãƒ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼"]},
];

let selected = new Set();
function catSelect(btn, doSelect){
  const cat = btn.closest('.category');
  cat.querySelectorAll('.gear-item input').forEach(cb => {
    cb.checked = doSelect;
    const item = cb.dataset.item;
    const p = cb.closest('.gear-item');
    if(doSelect){ selected.add(item); p.classList.add('selected'); }
    else { selected.delete(item); p.classList.remove('selected'); }
  });
  updateUI();
}
function buildGearList() {
  const c = document.getElementById('gear-categories');
  GEAR_DATA.forEach((cat,ci) => {
    const d = document.createElement('div'); d.className='category';
    d.innerHTML = `<div class="category-header"><div class="category-name">${cat.cat}</div><div class="cat-btns"><button class="btn-cat" onclick="catSelect(this,true)">å…¨é¸æŠ</button><button class="btn-cat" onclick="catSelect(this,false)">è§£é™¤</button></div></div>`;
    cat.items.forEach((item,ii) => {
      const id=`g_${ci}_${ii}`;
      const row=document.createElement('label'); row.className='gear-item'; row.htmlFor=id;
      row.innerHTML=`<input type="checkbox" id="${id}" data-item="${item}"><div class="chk">âœ“</div><span class="gear-name">${item}</span>`;
      row.querySelector('input').addEventListener('change',function(){
        const p=this.closest('.gear-item');
        if(this.checked){selected.add(item);p.classList.add('selected');}
        else{selected.delete(item);p.classList.remove('selected');}
        updateUI();
      });
      d.appendChild(row);
    });
    c.appendChild(d);
  });
}
function updateUI(){
  const n=selected.size;
  document.getElementById('bar-count').textContent=n;
  document.getElementById('gen-btn').disabled=n===0;
  updateBarPrice();
}
function updateBarPrice(){
  const p=parseInt(document.getElementById('price-input').value)||0;
  document.getElementById('bar-price').textContent='Â¥'+p.toLocaleString();
}
document.getElementById('price-input').addEventListener('input',updateBarPrice);
function setPrice(v,btn){
  document.getElementById('price-input').value=v;
  document.querySelectorAll('.preset-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active'); updateBarPrice();
}
function selectAll(){
  document.querySelectorAll('.gear-item input').forEach(cb=>{
    cb.checked=true; cb.closest('.gear-item').classList.add('selected'); selected.add(cb.dataset.item);
  }); updateUI();
}
function clearAll(){
  document.querySelectorAll('.gear-item input').forEach(cb=>{
    cb.checked=false; cb.closest('.gear-item').classList.remove('selected');
  }); selected.clear(); updateUI();
}
let sheetOpen=false;
function toggleSheet(){
  sheetOpen=!sheetOpen;
  document.getElementById('bottom-bar').classList.toggle('expanded',sheetOpen);
}
function fmtP(n){return 'Â¥'+Number(n).toLocaleString();}
function generateEstimate(){
  const price=parseInt(document.getElementById('price-input').value)||50000;
  const client=document.getElementById('client-name').value||'â€”';
  const project=document.getElementById('project-name').value||'â€”';
  const date=document.getElementById('shoot-date').value;
  const estNoInput=document.getElementById('estimate-no').value;
  let estNo;
  if(estNoInput){
    estNo=estNoInput;
  } else {
    const d=new Date();
    const ymd=`${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`;
    if(!window._estCounter) window._estCounter={};
    if(!window._estCounter[ymd]) window._estCounter[ymd]=1;
    else window._estCounter[ymd]++;
    estNo=`${ymd}_${String(window._estCounter[ymd]).padStart(2,'0')}`;
  }
  const tax=Math.floor(price*0.1); const total=price+tax;
  const now=new Date();
  const todayFmt=`${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')}`;
  const shootDate=date?`${date.replace(/-/g,'.')}` :'â€”';

  let globalNum = 0;
  // Build all cat blocks with global numbering
  const allCatBlocks = GEAR_DATA.map(cat => {
    const selItems = cat.items.filter(item => selected.has(item));
    if(selItems.length === 0) return null;
    const rows = selItems.map(item => {
      globalNum++;
      return `<div class="p2-row"><span class="p2-num">${String(globalNum).padStart(2,'0')}</span><span class="p2-item">${item}</span></div>`;
    }).join('');
    // height estimate: category header=1, each item=1
    return { html: `<div class="p2-cat-block"><div class="p2-cat-label">${cat.cat}</div><div class="p2-cat-items">${rows}</div></div>`, lines: selItems.length + 1 };
  }).filter(Boolean);

  // Distribute categories into 3 columns balancing total line count
  const cols = [[], [], []];
  const colH = [0, 0, 0];
  allCatBlocks.forEach(block => {
    const minIdx = colH.indexOf(Math.min(...colH));
    cols[minIdx].push(block.html);
    colH[minIdx] += block.lines;
  });
  const col1 = cols[0].join('');
  const col2 = cols[1].join('');
  const col3 = cols[2].join('');

  document.getElementById('doc-content').innerHTML=`
    <!-- PAGE 1: è¦‹ç©æ›¸ -->
    <div class="page page1">
      <div class="page-inner">
        <div class="p1-header">
          <div class="p1-left">
            <div class="p1-logo">IMOK</div>
            <div class="p1-logo-sub">ä»Šå²¡ å€‹äººæ©Ÿæãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</div>
          </div>
          <div class="p1-right">
            <div class="p1-title">æ’®å½±æ©Ÿæè²» è¦‹ç©æ›¸</div>
            <div class="p1-meta">No. ${estNo}&nbsp;&nbsp;|&nbsp;&nbsp;${todayFmt}</div>
          </div>
        </div>
        <div class="p1-rule"></div>
        <div class="p1-info-grid">
          <div>
            <div class="p1-info-label">å®›å…ˆ</div>
            <div class="p1-info-value">${client !== "â€”" ? client + " å¾¡ä¸­" : "â€”"}</div>
          </div>
          <div>
            <div class="p1-info-label">æ¡ˆä»¶å</div>
            <div class="p1-info-value">${project}</div>
          </div>
          <div>
            <div class="p1-info-label">æ’®å½±æ—¥</div>
            <div class="p1-info-value">${shootDate}</div>
          </div>
          <div>
            <div class="p1-info-label">æ©Ÿææ‰€æœ‰è€…</div>
            <div class="p1-info-value">ä»Šå²¡åˆ©æ˜</div>
            <div class="p1-info-sub">ã€’165-0026 æ±äº¬éƒ½ä¸­é‡åŒºæ–°äº•1-36-9 å²¡ç”°ãƒ“ãƒ«302</div>
            <div class="p1-info-sub">TEL: 090-5526-8190</div>
            <div class="p1-info-sub">mail@t-imok.com</div>
            <div class="p1-info-sub">ç™»éŒ²ç•ªå·: T9810440218359</div>
          </div>
        </div>
        <table class="p1-table">
          <thead>
            <tr>
              <th class="p1-th-item">å“ç›®</th>
              <th class="p1-th-detail">è©³ç´°</th>
              <th class="p1-th-price">é‡‘é¡</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="p1-td-item">æ’®å½±æ©Ÿæè²»</td>
              <td class="p1-td-detail">ç§ç‰©æ©Ÿæä¸€å¼ï¼ˆ${selected.size}ç‚¹ï¼‰<br><span style="font-size:11px;color:#888">â€»è©³ç´°ã¯åˆ¥ç´™ æ©Ÿæä¸€è¦§ã‚’å‚ç…§</span></td>
              <td class="p1-td-price">${fmtP(price)}</td>
            </tr>
          </tbody>
        </table>
        <div class="p1-total-wrap">
          <div class="p1-total-box">
            <div class="p1-total-row"><span>å°è¨ˆ</span><span>${fmtP(price)}</span></div>
            <div class="p1-total-row"><span>æ¶ˆè²»ç¨ï¼ˆ10%ï¼‰</span><span>${fmtP(tax)}</span></div>
            <div class="p1-total-rule"></div>
            <div class="p1-total-row p1-total-main"><span>åˆè¨ˆ</span><span>${fmtP(total)}</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE 2: æ©Ÿæä¸€è¦§ -->
    <div class="page page2">
      <div class="page-inner">
        <div class="p1-header">
          <div class="p1-left">
            <div class="p1-logo">IMOK</div>
            <div class="p1-logo-sub">ä»Šå²¡ å€‹äººæ©Ÿæãƒ‘ãƒƒã‚±ãƒ¼ã‚¸</div>
          </div>
          <div class="p1-right">
            <div class="p1-title" style="letter-spacing:8px;">æ©Ÿ æ ä¸€ è¦§</div>
            <div class="p1-meta">No. ${estNo}&nbsp;&nbsp;|&nbsp;&nbsp;${todayFmt}</div>
          </div>
        </div>
        <div class="p1-rule"></div>
        <div class="p2-info-row">
          <span>æŒå‚æ©Ÿææ•°: <strong>${selected.size} ç‚¹</strong></span>
          <span>æ©Ÿææ‰€æœ‰è€…: <strong>ä»Šå²¡åˆ©æ˜</strong></span>
        </div>
        <div class="p2-columns">
          <div class="p2-col"><div class="p2-col-header-bar"><span class="p2-col-num-h">#</span><span>æ©Ÿ æ å ç§°</span></div>${col1}</div>
          <div class="p2-col"><div class="p2-col-header-bar"><span class="p2-col-num-h">#</span><span>æ©Ÿ æ å ç§°</span></div>${col2}</div>
          <div class="p2-col"><div class="p2-col-header-bar"><span class="p2-col-num-h">#</span><span>æ©Ÿ æ å ç§°</span></div>${col3}</div>
        </div>
        <div class="p2-footer">IMOK Personal Gear Package â€” ä»Šå²¡å€‹äººæ©Ÿæè¦‹ç©æ›¸ï¼ˆåˆ¥ç´™ï¼‰</div>
      </div>
    </div>
  `;
  window._lastEstNo = estNo;
  // Scale page-inner to fit .page container
  requestAnimationFrame(() => scalePages());
  document.getElementById('modal').classList.add('open');
  sheetOpen=false; document.getElementById('bottom-bar').classList.remove('expanded');
}

function scalePages() {
  document.querySelectorAll('.page').forEach(page => {
    const inner = page.querySelector('.page-inner');
    if (!inner) return;
    const scaleX = page.offsetWidth / 794;
    const scaleY = page.offsetHeight / 1123;
    const scale = Math.min(scaleX, scaleY);
    inner.style.transform = `scale(${scale})`;
  });
}
window.addEventListener('resize', scalePages);
function closeModal(){document.getElementById('modal').classList.remove('open');}
function printDoc(){
  const estNo = document.getElementById('estimate-no').value || window._lastEstNo || '';
  const project = document.getElementById('project-name').value || '';
  const parts = [estNo, project].filter(Boolean);
  document.title = parts.length ? parts.join('_') : 'è¦‹ç©æ›¸';

  // Safariãƒ»Chromeã©ã¡ã‚‰ã§ã‚‚ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ã‚’æŠ‘åˆ¶ã™ã‚‹ãŸã‚styleã‚’å‹•çš„æ³¨å…¥
  const styleId = 'print-margin-fix';
  if (!document.getElementById(styleId)) {
    const s = document.createElement('style');
    s.id = styleId;
    s.textContent = `@media print { @page { margin: 0 !important; size: A4 !important; } html, body { margin: 0 !important; padding: 0 !important; } }`;
    document.head.appendChild(s);
  }
  setTimeout(() => window.print(), 200);
}
buildGearList();
document.getElementById('shoot-date').value=new Date().toISOString().split('T')[0];
</script>
</body>
</html>
